# 基于注意力机制的植物叶片病害细粒度识别研究报告

---

## 摘要

本项目旨在解决农业生产中，由于不同病害间视觉特征高度相似导致的细粒度识别难题。为此，我设计并实现了一个基于注意力机制的植物叶片病害自动识别系统。该系统以 ResNet-50 作为基线模型，并进一步探索了集成注意力机制（SE-Net, CBAM）对模型性能的提升效果。实验数据采用公开数据集 PlantVillage 的一个子集，主要针对番茄的四种叶片状况（细菌性斑点病、褐斑病、靶斑病及健康叶片）。通过图像预处理和数据增强，提升了模型的泛化能力。实验结果表明，引入通道注意力机制的 SE-ResNet-50 模型在准确率等关键指标上均优于基线模型和 CBAM 模型，验证了通道注意力方法的有效性。系统最终通过 Flask Web 应用提供服务，实现了从图像上传到病害识别的端到端解决方案。

---

## 1. 引言

植物病害是影响农业生产和全球粮食安全的关键因素之一。及时准确地识别病害对于采取有效防治措施至关重要。然而，许多不同的植物病害在视觉上表现出高度相似的症状（如相似的斑点、颜色或纹理），或者同一病害在不同发展阶段下的差异十分细微，这使得自动化、精确的细粒度识别成为一项极具挑战性的任务。传统的计算机视觉方法或标准深度学习模型在区分这些细微差别时常常遇到瓶颈。

为应对这一挑战，我提出了一种基于卷积神经网络（CNN）并融合注意力机制的方法。我采用预训练的 ResNet-50 作为基础特征提取器，它能够为植物叶片图像提供有效的基础特征表示。在此基础上，我集成了 SE-Net 和 CBAM 注意力模块，旨在引导模型自动聚焦于图像中最具区分性的病灶区域或特征，从而提高对外观相似病害的识别准确率。

本文的主要贡献包括：

-   实现了一个基于 ResNet-50 的植物病害识别基线模型。
-   对比分析了 SE-Net 和 CBAM 注意力机制在番茄叶片病害细粒度识别任务中的作用和效果。
-   开发了一个集成了最优模型的 Web 应用，提供了直观、便捷的人机交互界面。

---

## 2. 相关工作

近年来，深度学习在农业图像分析领域展现出巨大潜力。经典模型如 AlexNet、GoogLeNet 和 ResNet (Mohanty et al., 2016; Ferentinos, 2018) 已被证明在植物病害分类任务上是有效的。

国内外的研究者们也在此基础上进行了更深入的探索，尤其是在细粒度识别方面。一个主要的研究方向是引入**注意力机制**。例如，Wang 等人 (2021) 探索了改进 CBAM 模块在农作物病虫害细粒度识别中的应用。Hu 等人 (2019) 则将注意力与残差机制结合，用于识别细粒度的番茄病害。这些研究表明，注意力机制能有效引导模型关注关键病灶区域。

另一个方向是**模型架构的创新与轻量化**，以适应移动端或实时检测的需求。例如，Li 等人 (2023) 和 Xue 等人 (2024) 分别基于改进的 YOLOX-Nano 和 YOLOv8 算法，实现了对农作物叶片的实时病害检测。此外，一些研究工作（于明等, 2022; 张莉等, 2024）还将注意力机制与颜色空间分析、迁移学习等技术结合，以处理小样本或复杂背景下的识别问题。

我的工作吸收了上述研究思路，侧重于系统性地对比两种主流注意力机制（SE-Net 和 CBAM）在 ResNet-50 基础模型上的作用，以验证其在解决番茄叶片病害细粒度分类问题上的有效性。

---

## 3. 数据与方法

### 3.1 数据

本研究使用的数据来源于公开的 **PlantVillage 数据集**，我选取了其中关于番茄叶片的子集，专注于以下四种类别：

1.  **细菌性斑点病 (Bacterial spot)**
2.  **褐斑病 (Brown spot / Septoria leaf spot)**
3.  **靶斑病 (Target Spot)**
4.  **健康叶片 (Healthy)**

**数据集结构与预处理**:
我首先将数据集划分为训练集和验证集。为了适配 PyTorch 的数据加载器，数据被组织成如下结构：

```
data/processed/
├── train/
│   ├── Tomato___Bacterial_spot/
│   ├── Tomato___Septoria_leaf_spot/
│   ├── Tomato___Target_Spot/
│   └── Tomato___healthy/
└── val/
    ├── Tomato___Bacterial_spot/
    └── ... (其他类别)
```

所有图像都经过了统一的预处理流程：

1.  **统一尺寸**: 缩放到 224x224 像素。
2.  **数据增强**: 采用在线数据增强，包括随机旋转、翻转、调整亮度、对比度和饱和度。
3.  **归一化**: 将像素值从 `[0, 255]` 归一化到 `[0.0, 1.0]`，再根据 ImageNet 的均值和标准差进行标准化。

### 3.2 方法

我的核心方法是构建和对比三种基于 ResNet-50 的深度学习模型。

**1. 基线模型 (Baseline Model)**
我选择 **ResNet-50** 作为基线模型。它通过残差连接解决了深度网络的梯度消失问题。我使用在 ImageNet 上预训练的模型，并在我的病害数据集上进行微调。

**2. SE-ResNet-50 模型**
我在 ResNet-50 的残差模块中嵌入了 **SE (Squeeze-and-Excitation) 模块**。SE 模块通过学习通道间的关系，为每个特征通道生成一个权重，从而增强有用特征，抑制无关特征。

![SE Module](https://www.researchgate.net/profile/Jien-Dong-Chen/publication/332822123/figure/fig4/AS:754341995814912@1556858971932/The-structure-of-an-SE-block.ppm)
_图 1: SE 模块结构示意图_

**3. CBAM-ResNet-50 模型**
我实现了集成了 **CBAM (Convolutional Block Attention Module)** 的模型。CBAM 结合了通道注意力和空间注意力，不仅让模型知道要注意"什么"（通道），还知道要注意"哪里"（空间位置），理论上能更全面地捕捉关键信息。

**实现细节**:

-   **框架**: PyTorch
-   **优化器**: AdamW
-   **损失函数**: 带标签平滑的交叉熵损失
-   **学习率调度**: Cosine Annealing

---

## 4. 实验分析

### 4.1 实验设置与评估方案

我分别在三种模型上进行了训练和评估，所有模型均使用相同的训练配置，以确保对比的公平性。评估方案如下：

-   **基线对比**：将标准 ResNet-50 模型作为基线，用以衡量注意力机制带来的性能提升。
-   **评估指标**：
    -   **Top-1 准确率 (Accuracy)**：衡量模型整体的识别能力。
    -   **精确率 (Precision)**、**召回率 (Recall)** 和 **F1 分数 (F1-Score)**：更全面地评估模型性能。
    -   **混淆矩阵 (Confusion Matrix)**：重点分析，用于量化模型在区分易混淆病害类别上的能力，清晰地展示模型的分类情况。

### 4.2 实验结果

如下表所示，所有模型均取得了较高的性能，但引入注意力机制后的效果出现了分化。

**表 1: 不同模型的性能对比**
| Model | Accuracy | Macro Precision | Macro Recall | Macro F1-Score |
|---|---|---|---|---|
| **SE-ResNet-50** | **99.85%** | **0.9986** | **0.9985** | **0.9986** |
| Baseline ResNet-50| 99.42% | 0.9937 | 0.9940 | 0.9938 |
| CBAM-ResNet-50 | 98.98% | 0.9887 | 0.9897 | 0.9892 |

_注：数据来源于项目内评估脚本 `scripts/comprehensive_evaluation.py` 的运行结果。_

从结果可以看出：

-   **SE-ResNet-50** 取得了最佳性能，在所有核心指标上均超越了基线模型，准确率达到了 99.85%。这有力地证明了通道注意力机制在筛选病害相关特征通道上的有效性。
-   与预想不同，**CBAM-ResNet-50** 在本任务中的表现略逊于基线模型。虽然其准确率也达到了近 99%，但低于 Baseline。这可能意味着，对于当前的番茄叶片数据集，CBAM 引入的空间注意力模块可能带来了一些噪声或干扰，或者其复杂的结构需要更精细的超参数调整才能发挥优势。这是一个值得进一步深入研究的现象。

### 4.3 可视化分析

#### 混淆矩阵

为了更深入地分析模型的分类性能，特别是对于容易混淆的类别，我生成了各个模型的混淆矩阵。下图展示了表现最佳的 **SE-ResNet-50** 模型的混淆矩阵。

![SE-Net Confusion Matrix](outputs/evaluation/senet_evaluation_20250611_143737/confusion_matrix.png)
_图 2: SE-ResNet-50 模型在测试集上的混淆矩阵_

从混淆矩阵可以看出，模型在绝大多数类别上都取得了完美的分类。仅有的 2 个错误分类案例（1 个 `bacterial_spot` 被误分为 `septoria_leaf_spot`，1 个 `target_spot` 被误分为 `bacterial_spot`）表明模型在区分这几种斑点类病害时仍有极小的提升空间。总体而言，该图表直观地验证了模型在细粒度分类任务上的高精度。

#### 注意力热力图 (Grad-CAM)

为了更直观地理解注意力机制的作用，我使用 Grad-CAM 技术生成了热力图，可视化不同模型在做决策时重点关注的图像区域。下图展示了三种模型（基线 ResNet-50、SE-ResNet-50 和 CBAM-ResNet-50）在三种不同样本上的注意力分布对比：

![Model Comparison](outputs/visualization/model_comparisons/complete_model_comparison.png)
_图 3: 三种模型在不同病害样本上的 Grad-CAM 热力图对比_

从热力图比较可以明显看出不同注意力机制的特点：

1. **基线 ResNet-50**（第一行）：注意力热区相对分散，在一些样本上会关注到叶片周围的背景区域。

2. **SE-ResNet-50**（第二行）：注意力集中在叶片的病害特征区域，热区更加精确且聚焦。特别是在细菌性斑点病和靶斑病样本上，SE-Net 能够准确地定位到病斑区域，忽略背景干扰。

3. **CBAM-ResNet-50**（第三行）：虽然也能关注到病害区域，但热区较为分散，且在一些样本上的注意力不如 SE-Net 集中。

以细菌性斑点病样本为例，我们可以更详细地分析三种模型的差异：

![Bacterial Spot Comparison](outputs/visualization/model_comparisons/bacterial_spot_model_comparison.png)
_图 4: 三种模型在细菌性斑点病样本上的注意力热力图对比_

从热力图可以清晰地看到，SE-Net 模型能够精确地将注意力集中在叶片上的病斑区域，这些区域正是细菌性斑点病的典型症状表现。相比之下，基线模型和 CBAM 模型的注意力分布则相对分散，有时会关注到一些非关键区域。

这种针对性的关注能力验证了通道注意力机制的有效性 —— 它能够引导模型关注到最具诊断价值的特征，而忽略背景和其他无关区域。这也解释了为什么 SE-ResNet-50 在测试集上取得了更高的准确率 —— 它能够更好地捕捉细粒度的病害特征。

SE-Net 模型热力图更加集中和精确的特点，表明通道注意力机制确实提高了模型对关键特征的敏感度。这种优势在识别相似度高的细粒度病害时尤为重要，也是该模型取得最佳性能的关键因素。

---

## 5. 总结

本项目成功设计并实现了一个基于注意力机制的植物叶片病害细粒度识别系统。通过系统的实验对比，我得出以下结论：

1.  基于 ResNet-50 的深度学习模型能够高效、准确地识别番茄叶片病害。
2.  引入**通道注意力机制（SE-Net）**可以显著提升模型的细粒度识别性能，在本项目的测试中取得了最佳效果。
3.  **CBAM 模块**在本任务中的表现未达到预期，其性能略低于基线模型，表明更复杂的注意力机制并不总能保证在所有任务上都获得性能提升。

**未来展望**:

-   **数据扩展**: 收集更多种类、更复杂背景的病害数据，提升模型的泛化能力。
-   **多模态融合**: 结合气象、土壤等多模态数据，构建更综合的病害预测系统。

---
